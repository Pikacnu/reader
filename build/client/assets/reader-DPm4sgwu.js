import{r as n,j as t}from"./jsx-runtime-C2JdrU5W.js";function le({chapter:y,chapter_index:v,page_index:u}){const[O,q]=n.useState(!1),[E,K]=n.useState("undefined"),[F,G]=n.useState(1920),[k,J]=n.useState(1080),[T,Q]=n.useState(0),[N,U]=n.useState(0),[d,w]=n.useState(u.current||0),[h,V]=n.useState("ltr"),[b,X]=n.useState("#FFFFFF"),[m,D]=n.useState(v.current||0),f=n.useRef(!1),H=n.useCallback(e=>{const s=e.replace("#",""),c=parseInt(s.substring(0,2),16),l=parseInt(s.substring(2,4),16),r=parseInt(s.substring(4,6),16);return(c*299+l*587+r*114)/1e3>=128?"#000000":"#FFFFFF"},[]),R=n.useMemo(()=>H(b),[H,b]),B=24,M=12,[z,Y]=n.useState(16),Z=n.useCallback(e=>{Y(e>B?B:e<M?M:e)},[]),[P,_]=n.useState(!1),[S,ee]=n.useState(""),[C,te]=n.useState(2),I=4.5,A=1,ne=n.useCallback(e=>{te(e>I?I:e<A?A:e)},[]),L=n.useMemo(()=>`${C/2}em`,[C]),o=n.useMemo(()=>`${C}em`,[C]),re=n.useCallback((e,s)=>{const c=new Map;return s==="rtl"?e:e===""?"":e.split("").reduce((l,r)=>{const a=c.get(r);return l+(a||r)})},[]),x=n.useMemo(()=>{const e=Math.floor(k/N),s=Math.floor(F/T)-(E==="desktop"?3:1);return[y.pages[m]].reduce((r,a)=>{let g=a.content.reduce((j,i)=>{if(i.length>e){const se=i.split("").reduce((p,$)=>p[p.length-1].length<e?(p[p.length-1]+=$,p):[...p,$],[""]);return[...j,...se]}return[...j,i]},[""]);return[...r,...g]},[""]).reduce((r,a)=>{if(r.length===0)return[[a]];const g=r[r.length-1];return g.length<s?(g.push(a),r):[...r,[a]]},[[""]])},[y,F,k,T,N,z,m]);n.useEffect(()=>{K(window.innerWidth<640?"mobile":window.innerWidth<1920?"tablet":"desktop"),setTimeout(()=>{W()},1e3)},[]),n.useEffect(()=>{const e=l=>{var r,a,g,j;if(l.key==="ArrowRight"){if(d===0&&m===0)return;if(m===0&&(u&&(u.current=d-1),w(i=>i-1)),!f.current)return(r=document.getElementById("changeChapter"))==null||r.removeAttribute("hidden"),f.current=!0;f.current=!1,(a=document.getElementById("changeChapter"))==null||a.setAttribute("hidden",""),w(0),D(i=>i-1),u&&(u.current=0),v&&(v.current=m-1);return}if(l.key==="ArrowLeft"){if(y.pages.length===m+1&&d!==x.length-1)return u&&(u.current=d+1),w(i=>i+1);if(d===x.length-1&&y.pages.length!==m+1){if(!f.current)return(g=document.getElementById("changeChapter"))==null||g.removeAttribute("hidden"),f.current=!0;f.current=!1,(j=document.getElementById("changeChapter"))==null||j.setAttribute("hidden",""),w(0),D(i=>i+1),u&&(u.current=0),v&&(v.current=m+1);return}return d===x.length-1?void 0:w(i=>i+1)}if(l.key==="Control")return q(i=>!i)},s=l=>{var r;e({key:((r=l.currentTarget)==null?void 0:r.id)||""})};document.addEventListener("keydown",e);const c=document.getElementsByClassName("Touch");for(const l of c)l.addEventListener("click",s);return()=>{document.removeEventListener("keydown",e);const l=document.getElementsByClassName("Touch");for(const r of l)r.removeEventListener("click",s)}},[d,x,T,N,k,E]);const W=n.useCallback(()=>{var e,s;G(window.innerWidth),J(window.innerHeight),Q(Math.floor((((e=document.getElementById("textsize"))==null?void 0:e.getBoundingClientRect().width)||0)/2)),U(Math.floor((((s=document.getElementById("textsize"))==null?void 0:s.getBoundingClientRect().height)||0)/2))},[]);return n.useEffect(()=>(window.addEventListener("resize",()=>{W()}),()=>{window.removeEventListener("resize",()=>{W()})}),[k,F,N,T]),t.jsxs("div",{className:"flex flex-col w-full h-svh overflow-hidden",style:{backgroundColor:b,color:R,fontSize:z},children:[t.jsx("div",{className:"absolute bg-yellow-400 m-2 p-2 rounded-full",id:"changeChapter",hidden:!0,children:"即將更換章節"}),t.jsxs("div",{id:"textsize",className:"flex w-min h-min absolute invisible pr-8 pl-8 *:m-0 *:p-0",style:h==="ltr"?{marginLeft:o,marginRight:o}:{marginTop:o,marginBottom:o},children:[t.jsx("p",{children:"你好"}),t.jsx("p",{children:"世界"})]}),t.jsxs("div",{id:"textsize-en-s",className:"flex w-min h-min absolute invisible pr-8 pl-8 *:m-0 *:p-0",style:h==="ltr"?{marginLeft:o,marginRight:o}:{marginTop:o,marginBottom:o},children:[t.jsx("p",{children:"rr"}),t.jsx("p",{children:"rr"})]}),t.jsxs("div",{id:"textsize-en-b",className:"flex w-min h-min absolute invisible pr-8 pl-8 *:m-0 *:p-0",style:h==="ltr"?{marginLeft:o,marginRight:o}:{marginTop:o,marginBottom:o},children:[t.jsx("p",{children:"RR"}),t.jsx("p",{children:"RR"})]}),t.jsxs("div",{className:"flex-shrink flex-grow flex relative",children:[E!=="desktop"?t.jsx(t.Fragment,{children:t.jsxs("div",{className:"w-full h-full *:w-1/3 *:h-full absolute flex flex-row",children:[t.jsx("div",{id:"ArrowLeft",className:"Touch"}),t.jsx("div",{id:"Control",className:"Touch"}),t.jsx("div",{id:"ArrowRight",className:"Touch"})]})}):t.jsx(t.Fragment,{}),t.jsx("div",{className:`text-${h} mt-4 w-full flex flex-warp ${h==="rtl"?"flex-col":"flex-col-reverse"}`,children:x[d].map((e,s)=>{const c=re(e.toString(),h);return t.jsx("p",{style:Object.assign(P&&S?{backgroundColor:c.includes(S)?R:"transparent",color:c.includes(S)?b:R}:{},h==="ltr"?{marginLeft:L,marginRight:L}:{marginTop:L,marginBottom:L}),children:c},s)})})]}),t.jsx("div",{className:"flex flex-row h-8 items-center justify-center *:m-2 text-lg",children:t.jsxs("p",{children:[d+1,"/",x.length]})}),t.jsxs("div",{className:`flex flex-row w-full justify-center *:ml-2 *:mr-2 p-2 text-lg bg-slate-400 flex-wrap ${O?"":"hidden"}`,children:[t.jsx("button",{onClick:()=>V(h==="ltr"?"rtl":"ltr"),children:h}),t.jsx("input",{type:"color",value:b,className:"all-unset w-8 h-8",onChange:e=>X(e.target.value)}),t.jsx("input",{type:"range",value:z,min:M,max:B,className:"w-16 h-8",onChange:e=>Z(Number(e.target.value))}),t.jsxs("div",{children:[t.jsx("input",{type:"text",value:S,onChange:e=>ee(e.target.value),className:"w-32 bg-transparent border-b-2 border-gray-500"}),t.jsx("button",{onClick:()=>{_(e=>!e)},className:"w-16",children:P?"searching":"search"})]}),t.jsx("input",{type:"range",value:C,min:A,max:I,step:.1,onChange:e=>ne(Number(e.target.value))})]})]})}export{le as R};
